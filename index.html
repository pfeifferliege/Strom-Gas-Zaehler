<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Strom- und Gaskosten Rechner</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; max-width: 700px; }
  input[type="number"] { width: 120px; padding: 6px; margin: 5px 10px 15px 0; }
  select { padding: 6px; margin: 5px 10px 15px 0; }
  button { padding: 8px 15px; margin-top: 10px; cursor: pointer; }
  .result { margin-bottom: 15px; }
  hr { border: 1px solid #ddd; margin: 10px 0; }
  .positive { color: green; font-weight: bold; }
  .negative { color: red; font-weight: bold; }
  strong { font-weight: bold; }
</style>
</head>
<body>

<h2>Strom- und Gaskosten Rechner</h2>

<label>Strom ZÃ¤hlerstand Vormonat:</label>
<input type="number" id="stromVormonat" min="0" step="0.01" /><br />

<label>Strom ZÃ¤hlerstand Aktuell:</label>
<input type="number" id="stromAktuell" min="0" step="0.01" /><br />

<label>Strom Tarif:</label>
<select id="stromTarif">
  <option value="low">Niedriger Tarif (0,30â‚¬/kWh + 10â‚¬ GrundgebÃ¼hr)</option>
  <option value="medium">Mittlerer Tarif (0,35â‚¬/kWh + 15â‚¬ GrundgebÃ¼hr)</option>
  <option value="high">Hoher Tarif (0,40â‚¬/kWh + 20â‚¬ GrundgebÃ¼hr)</option>
</select><br />

<label>Gas ZÃ¤hlerstand Vormonat (mÂ³):</label>
<input type="number" id="gasVormonat" min="0" step="0.01" /><br />

<label>Gas ZÃ¤hlerstand Aktuell (mÂ³):</label>
<input type="number" id="gasAktuell" min="0" step="0.01" /><br />

<label>Gas Tarif:</label>
<select id="gasTarif">
  <option value="standard">Standard Tarif (0,06â‚¬/kWh)</option>
  <option value="premium">Premium Tarif (0,05â‚¬/kWh)</option>
</select><br />

<label>Monatlicher Abschlag (â‚¬):</label>
<input type="number" id="monatlicherAbschlag" min="0" step="0.01" value="100" /><br />

<button onclick="berechnen()">Berechnen</button>

<h3>Monatliche Einzelergebnisse</h3>
<div id="monatsErgebnisse"></div>

<h3>GesamtÃ¼bersicht</h3>
<p>Gesamtkosten Strom: <span id="gesamtStrom">0.00 â‚¬</span></p>
<p>Gesamtkosten Gas: <span id="gesamtGas">0.00 â‚¬</span></p>
<p>Gesamtkosten Strom + Gas: <span id="gesamtSumme">0.00 â‚¬</span></p>
<p>Gezahlte AbschlÃ¤ge: <span id="gezahltAbschlag">0.00 â‚¬</span></p>
<p>Guthaben / Nachzahlung: <span id="guthaben" class="positive">0.00 â‚¬</span></p>

<script>
// Tarifdaten
const stromPreise = {
  low: { preisProKWh: 0.30, grundgebuehr: 10 },
  medium: { preisProKWh: 0.35, grundgebuehr: 15 },
  high: { preisProKWh: 0.40, grundgebuehr: 20 },
};

function berechneGasKosten(verbrauchKWh, tarif) {
  let preisProKWh = tarif === "premium" ? 0.05 : 0.06;
  return verbrauchKWh * preisProKWh;
}

// Globale Variablen fÃ¼r Summen
let gesamtStromKosten = 0;
let gesamtGasKosten = 0;
let gezahlteAbschlaege = 0;

function berechnen() {
  let stromVormonat = parseFloat(document.getElementById("stromVormonat").value) || 0;
  let stromAktuell = parseFloat(document.getElementById("stromAktuell").value) || 0;
  let gasVormonat = parseFloat(document.getElementById("gasVormonat").value) || 0;
  let gasAktuell = parseFloat(document.getElementById("gasAktuell").value) || 0;
  let monatlicherAbschlag = parseFloat(document.getElementById("monatlicherAbschlag").value) || 0;

  let stromKosten = 0;
  let stromVerbrauch = 0;
  if (stromAktuell > 0 && stromVormonat > 0 && stromAktuell >= stromVormonat) {
    stromVerbrauch = stromAktuell - stromVormonat;
    let stromTarif = stromPreise[document.getElementById("stromTarif").value];
    stromKosten = stromVerbrauch * stromTarif.preisProKWh + stromTarif.grundgebuehr;
  }

  let gasKosten = 0;
  let gasVerbrauchM3 = 0;
  let gasVerbrauchKWh = 0;
  if (gasAktuell > 0 && gasVormonat > 0 && gasAktuell >= gasVormonat) {
    gasVerbrauchM3 = gasAktuell - gasVormonat;
    gasVerbrauchKWh = gasVerbrauchM3 * 10.5;
    gasKosten = berechneGasKosten(gasVerbrauchKWh, document.getElementById("gasTarif").value);
  }

  let gesamtkosten = stromKosten + gasKosten;
  let bilanz = monatlicherAbschlag - gesamtkosten;

  // Summen hochzÃ¤hlen
  gesamtStromKosten += stromKosten;
  gesamtGasKosten += gasKosten;
  gezahlteAbschlaege += monatlicherAbschlag;

  let timestamp = new Date().toLocaleString('de-DE', { month: 'long', year: 'numeric' });

  // Ergebnis-HTML bauen
  let ergebnis = `
    <div class="result">
      <strong>${timestamp}</strong><br><hr>
      ${stromKosten > 0 ? `<strong>ðŸ”Œ Strom:</strong><br>
      Verbrauch: ${stromAktuell} - ${stromVormonat} = ${stromVerbrauch} kWh<br>
      Kosten: ${stromKosten.toFixed(2)} â‚¬<br><hr>` : ''}
      ${gasKosten > 0 ? `<strong>ðŸ”¥ Gas:</strong><br>
      Verbrauch: ${gasAktuell} - ${gasVormonat} = ${gasVerbrauchM3} mÂ³<br>
      Umrechnung: ${gasVerbrauchKWh.toFixed(2)} kWh<br>
      Kosten: ${gasKosten.toFixed(2)} â‚¬<br><hr>` : ''}
      Gesamtkosten: <span class="${gesamtkosten >= monatlicherAbschlag ? 'negative' : 'positive'}">${gesamtkosten.toFixed(2)} â‚¬</span><br>
      <strong style="color: blue;">Gezahlter Abschlag: ${monatlicherAbschlag.toFixed(2)} â‚¬</strong><br>
      Guthaben/Nachzahlung: <span class="${bilanz >= 0 ? 'positive' : 'negative'}">${bilanz.toFixed(2)} â‚¬</span>
    </div>
    <hr>
  `;

  // Ergebnisse aus localStorage holen, neuen Eintrag vorne hinzufÃ¼gen
  const ergebnisse = JSON.parse(localStorage.getItem("ergebnisse") || "[]");
  ergebnisse.unshift({ timestamp, html: ergebnis });
  localStorage.setItem("ergebnisse", JSON.stringify(ergebnisse));

  // Ergebnisse anzeigen (neueste oben)
  document.getElementById("monatsErgebnisse").innerHTML = ergebnisse.map(e => e.html).join('');

  // GesamtÃ¼bersicht aktualisieren
  document.getElementById("gesamtStrom").textContent = gesamtStromKosten.toFixed(2) + " â‚¬";
  document.getElementById("gesamtGas").textContent = gesamtGasKosten.toFixed(2) + " â‚¬";
  document.getElementById("gesamtSumme").textContent = (gesamtStromKosten + gesamtGasKosten).toFixed(2) + " â‚¬";
  document.getElementById("gezahltAbschlag").textContent = gezahlteAbschlaege.toFixed(2) + " â‚¬";

  let gesamterBilanz = gezahlteAbschlaege - (gesamtStromKosten + gesamtGasKosten);
  const guthabenElem = document.getElementById("guthaben");
  guthabenElem.textContent = gesamterBilanz.toFixed(2) + " â‚¬";
  guthabenElem.className = gesamterBilanz >= 0 ? "positive" : "negative";

  // ZÃ¤hlerstÃ¤nde fÃ¼r nÃ¤chsten Monat vorbereiten
  document.getElementById("stromVormonat").value = stromAktuell;
  document.getElementById("gasVormonat").value = gasAktuell;

  // Aktuelle Eingabefelder leeren
  document.getElementById("stromAktuell").value = "";
  document.getElementById("gasAktuell").value = "";
}

// Initiale Werte aus localStorage laden (optional)
window.onload = () => {
  const stromVor = localStorage.getItem("stromVormonat");
  const gasVor = localStorage.getItem("gasVormonat");
  const ergebnisse = JSON.parse(localStorage.getItem("ergebnisse") || "[]");

  if (stromVor) document.getElementById("stromVormonat").value = stromVor;
  if (gasVor) document.getElementById("gasVormonat").value = gasVor;
  if (ergebnisse.length > 0) {
    document.getElementById("monatsErgebnisse").innerHTML = ergebnisse.map(e => e.html).join('');
  }
};
</script>

</body>
</html>
